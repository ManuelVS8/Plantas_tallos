<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Las plantas y el tallo</title>
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/icono.ico">
    <style>
        /* ====== Reset & base ====== */
        * { box-sizing: border-box; margin:0; padding:0; }
        :root{
            --blue:#001DFF;
            --blue-dark:#04032B; /* Azul oscuro solicitado para t√≠tulos */
            --blue-700:#1a3a5f;
            --blue-600:#254fba;
            --orange:#f59e42;
            --orange-700:#e67e22;
            --bg-grad-1:#1a3a5f;
            --bg-grad-2:#0d2340;
            --white:#ffffff;
            --green:#2ecc71;
            --red:#e74c3c;
            --panel:#E8EAFF;
        }
        body{
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-grad-1) 0%, var(--bg-grad-2) 100%);
            min-height:100vh; 
            display:flex; 
            justify-content:center; 
            align-items: flex-start; 
            color:#333; 
            padding: 40px 10px 20px 10px; 
        }
        .game-container{
            background:var(--white); border-radius:16px; box-shadow:0 12px 24px rgba(0,0,0,.12);
            padding:1.2rem; max-width:980px; width:100%; min-height:640px; position:relative; overflow:hidden;
            display:flex; flex-direction:column;
        }
        header{ text-align:center; margin-bottom:.8rem; margin-top:1rem; }
        h1{ color:var(--blue-dark); font-size:clamp(2.1rem,5vw,3rem); font-weight:900; letter-spacing:.5px; margin-bottom: 0.5rem; }
        .subtitle{ color:var(--blue-700); font-size:clamp(1rem,3vw,1.3rem); margin-top:.25rem; font-weight: 600; line-height: 1.4; }
        .highlight-keyword{ color:var(--orange); font-weight:800; }
        
        /* Colores espec√≠ficos para subt√≠tulos */
        .txt-arbol{ color: var(--blue-600); }
        .txt-arbusto{ color: var(--red); }
        .txt-hierba{ color: var(--green); }

        /* Buttons */
        .btn{ color:#fff; border:none; padding:.75rem 1.2rem; border-radius:10px; cursor:pointer; font-weight:800;
            transition:transform .08s ease, box-shadow .2s ease, background-color .25s ease; min-width:180px; height:54px;
            display:inline-flex; align-items:center; justify-content:center; font-size: 1.2rem; margin-top: 1rem; z-index: 5; }
        .btn:hover{ transform:translateY(-2px); box-shadow:0 6px 14px rgba(0,0,0,.12); }
        .btn:active{ transform:translateY(0); }
        .btn-primary{ background:var(--orange); }
        .btn-primary:hover{ background:var(--orange-700); color:#fff; }
        
        /* Botones de respuesta */
        .answer-buttons{ display: flex; gap: 10px; width: 100%; justify-content: center; margin-top: 1.5rem; flex-wrap: wrap; }
        .btn-arbol{ background: var(--blue-600); flex: 1; min-width: 120px; }
        .btn-arbusto{ background: var(--red); flex: 1; min-width: 120px; }
        .btn-hierba{ background: var(--green); flex: 1; min-width: 120px; }
        
        /* Feedback visual en botones */
        .btn-correct { background-color: #2ecc71 !important; transform: scale(1.05); }
        .btn-error { background-color: #e74c3c !important; }

        .screen{ display:none; animation:fadeIn .35s ease; flex-direction: column; flex:1;}
        .screen.active{ display:flex; }
        @keyframes fadeIn{ from{opacity:0; transform:translateY(12px);} to{opacity:1; transform:translateY(0);} }

        .game-info{ display:flex; gap:.6rem; align-items:center; justify-content:space-between; margin:.4rem 0 1rem; flex-wrap:wrap; }
        .timer{ font-weight:900; color:var(--blue-700); font-size:clamp(.95rem,2.3vw,1.15rem); }
        .level-indicator{ font-weight: 800; color: var(--blue-700); }
        .progress-bar{ flex:1; height:10px; background:#e6f2ff; border-radius:999px; overflow:hidden; }
        .progress-fill{ height:100%; width:0%; background:var(--orange); transition:width .3s ease; }

        /* Pantalla de Inicio - Estructura espec√≠fica */
        .start-content{ display:flex; flex-direction:column; align-items:center; flex:1; padding:1rem; text-align: center; }
        .advice-box{ background:var(--panel); border-left:4px solid var(--blue-700); padding:1.2rem; border-radius:12px;
            color:var(--blue-700); max-width:760px; font-size:clamp(1rem,3vw,1.2rem); line-height: 1.6; margin-bottom: 1rem; }
        .advice-anim-text { display: block; text-align: center; font-weight: 900; margin-top: 1rem; font-size: 1.4rem; }
        
        .start-image-container { width: 100%; display: flex; justify-content: center; margin-top: auto; padding-top: 1rem; }
        .start-image{ max-width: 400px; width: 100%; height: auto; display: block; }
        
        .mute-btn{ position:absolute; top:.8rem; right:1rem; background:var(--orange); color:#fff; border:2px solid #fff; width:38px; height:38px; border-radius:50%; cursor:pointer; font-size:1rem; display:flex; align-items:center; justify-content:center; z-index:20; }

        /* Panel de Juego */
        .board{ display:flex; flex-direction: column; gap:.8rem; align-items:center; }
        .help-box { background: var(--panel); padding: 0.8rem; border-radius: 10px; font-size: 1.1rem; text-align: center; margin-bottom: 0.5rem; width: 100%; }
        
        .card-display{ 
            background:#f8fbff; border:2px solid #d3e2ff; border-radius:12px; padding:2rem 1.5rem; 
            display:flex; flex-direction: column; align-items:center; justify-content:center; gap:.8rem; width: 100%; min-height: 180px;
        }
        .card-text{ font-size:clamp(1.4rem, 4.5vw, 2rem); font-weight:800; color:var(--blue-dark); text-align:center; line-height: 1.3; }
        
        .btn-play-word{ background:var(--blue-600); color:#fff; border:none; border-radius:50%; width:54px; height:54px; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:background-color .2s; }
        .btn-play-word svg{ width:30px; height:30px; }

        .stage{ background:#fff; border-radius:12px; border:2px solid #e6f2ff; padding:.6rem; width: 100%; max-width: 600px;}
        .img-wrap{ position:relative; width:100%; margin:0 auto; }
        .img-wrap img{ display:block; width:100%; height:auto; border-radius:10px; user-select:none; max-height: 350px; object-fit: contain; margin: 0 auto;}

        .shake { animation: shakeAnim 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shakeAnim {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* Pantalla Final */
        .results{ display:flex; flex-direction:column; align-items:center; gap:.6rem; text-align:center; flex:1; justify-content:center;}
        .final-title{ color:var(--blue-dark); font-weight:900; }
        .big-score{ font-size:clamp(2.5rem,7vw,4rem); color:var(--blue-600); font-weight:900; }
        #trophyBox { display: none; font-size: 5rem; animation: bounce 1s ease infinite; }
        @keyframes bounce { 0%,100%{ transform: translateY(0); } 50%{ transform: translateY(-15px); } }
        
        .school-logo { display: block; width: 180px; margin-top: 1rem; }
        .credit { font-weight: 700; margin-top: 0.5rem; }
        
        /* SISTEMA DE CONFETI */
        .confetti{ 
            position:fixed; 
            width:10px; 
            height:10px; 
            border-radius:50%; 
            animation: confetti-fall 3s linear forwards; 
            z-index:999; 
            pointer-events: none; 
        }
        @keyframes confetti-fall{ 
            0%{ transform:translate(0, -20px) rotate(0); opacity:1;} 
            100%{ transform:translate(var(--tx), var(--ty)) rotate(360deg); opacity:0; } 
        }
    </style>
</head>
<body>
<div class="game-container" id="mainContainer">
    <button class="mute-btn" id="muteBtn">üîä</button>

    <section class="screen active" id="startScreen">
        <header>
            <h1>Las plantas y el tallo</h1>
            <div class="subtitle">Clasifica las plantas seg√∫n las caracter√≠sticas de su tallo.</div>
        </header>
        
        <div class="start-content">
            <div class="advice-box">
                En este juego aprender√°s a diferenciar los diferentes tipos de plantas seg√∫n su tallo: <span class="highlight-keyword">√°rboles</span>, <span class="highlight-keyword">arbustos</span> e <span class="highlight-keyword">hierbas</span>.
                <span class="advice-anim-text">¬°√Ånimo!</span>
            </div>

            <div class="start-image-container">
                <img class="start-image" src="https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Ni%C3%B1os.png" alt="Imagen Ni√±os">
            </div>

            <button class="btn btn-primary" id="playBtn">Comenzar</button>
        </div>
    </section>

    <section class="screen" id="game1Screen">
        <header><h1>Las plantas y el tallo</h1></header>
        <div class="subtitle" style="text-align: center; margin-bottom: 10px;">
            Indica si las siguientes plantas son <span class="txt-arbol">√°rboles</span>, <span class="txt-arbusto">arbustos</span> o <span class="txt-hierba">hierbas</span>.
        </div>
        <div class="game-info">
            <div class="progress-bar"><div class="progress-fill" id="progressFill1"></div></div>
            <div class="level-indicator" id="levelLabel1">Nivel 1/9</div>
        </div>
        <div class="board">
            <div class="help-box"><b>Pulsa el bot√≥n</b> correspondiente para indicar si es un <span class="txt-arbol">√°rbol</span>, <span class="txt-arbusto">arbusto</span> o <span class="txt-hierba">hierba</span>.</div>
            <div class="stage" id="stageImg1">
                <div class="img-wrap"><img id="plantImg1" src=""></div>
            </div>
            <div class="answer-buttons">
                <button class="btn btn-arbol" onclick="checkAnswer('√Årbol', this)">√Årbol</button>
                <button class="btn btn-arbusto" onclick="checkAnswer('Arbusto', this)">Arbusto</button>
                <button class="btn btn-hierba" onclick="checkAnswer('Hierba', this)">Hierba</button>
            </div>
        </div>
    </section>

    <section class="screen" id="game2Screen">
        <header><h1>√Årboles, arbustos y hierbas</h1></header>
        <div class="subtitle" style="text-align: center; margin-bottom: 10px;">Indica a qu√© tipo de planta se refieren las siguientes definiciones.</div>
        <div class="game-info">
            <div class="progress-bar"><div class="progress-fill" id="progressFill2"></div></div>
            <div class="level-indicator" id="levelLabel2">Nivel 1/3</div>
        </div>
        <div class="board" id="board2">
            <div class="card-display">
                <div class="card-text" id="defText">‚Äî</div>
                <button class="btn-play-word" id="replayAudioBtn">
                    <svg viewBox="0 0 24 24" fill="none"><path d="M8 5v14l11-7z" fill="currentColor"/></svg>
                </button>
            </div>
            <div class="answer-buttons">
                <button class="btn btn-arbol" onclick="checkAnswer('√Årbol', this)">√Årbol</button>
                <button class="btn btn-arbusto" onclick="checkAnswer('Arbusto', this)">Arbusto</button>
                <button class="btn btn-hierba" onclick="checkAnswer('Hierba', this)">Hierba</button>
            </div>
        </div>
    </section>

    <section class="screen" id="game3Screen">
        <header><h1>Los paisajes</h1></header>
        <div class="subtitle" style="text-align: center; margin-bottom: 10px;">Indica si estas im√°genes son arboledas, matorrales o praderas.</div>
        <div class="game-info">
            <div class="progress-bar"><div class="progress-fill" id="progressFill3"></div></div>
            <div class="level-indicator" id="levelLabel3">Nivel 1/9</div>
        </div>
        <div class="board">
            <div class="stage" id="stageImg3">
                <div class="img-wrap"><img id="plantImg3" src=""></div>
            </div>
            <div class="answer-buttons">
                <button class="btn btn-arbol" onclick="checkAnswer('Arboleda', this)">Arboleda</button>
                <button class="btn btn-arbusto" onclick="checkAnswer('Matorral', this)">Matorral</button>
                <button class="btn btn-hierba" onclick="checkAnswer('Pradera', this)">Pradera</button>
            </div>
        </div>
    </section>

    <section class="screen" id="finalScreen">
        <header><h1 class="final-title">Las plantas y el tallo</h1></header>
        <div class="results">
            <div id="trophyBox">üèÜ</div>
            <div class="score-title" style="font-weight: 800; font-size: 1.4rem;">Puntuaci√≥n:</div>
            <div class="big-score" id="finalScore">0</div>
            <div class="final-time" style="font-weight: 700;">Tiempo total: <span id="finalTime">00:00</span></div>
            <div id="finalMsg" class="subtitle"></div>
            <button class="btn btn-primary" id="backToMenuBtn" style="background:var(--orange);">Volver al men√∫</button>
            <span class="credit">Creado por Manuel J. Ventura</span>
            <img class="school-logo" src="https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Siurot.png">
        </div>
    </section>
</div>

<script>
    let isMuted = false, audioUnlocked = false, startTime = 0, timerInterval = null, elapsed = 0;
    let currentScreen = 'start';
    let currentIndex = 0;
    let score1 = 0, score2 = 0, score3 = 0;
    let currentAudio = null, audioTimeout = null;

    const audioObjs = {
        correct: new Audio('https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Correcto.mp3'),
        error: new Audio('https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Error.mp3'),
        tap: new Audio('https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Tap.mp3'),
        victory: new Audio('https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Termin%C3%A9.mp3'),
        completed: new Audio('https://raw.githubusercontent.com/ManuelVS8/Efectos_audio/refs/heads/main/Completado.mp3')
    };

    const game1Data = [
        { type: '√Årbol', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arbol1.png' },
        { type: '√Årbol', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arbol2.png' },
        { type: '√Årbol', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arbol3.png' },
        { type: 'Arbusto', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arbusto1.png' },
        { type: 'Arbusto', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arbusto2.png' },
        { type: 'Arbusto', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arbusto3.png' },
        { type: 'Hierba', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/hierba1.png' },
        { type: 'Hierba', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/hierba2.png' },
        { type: 'Hierba', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/hierba3.png' }
    ];

    const game2Data = [
        { type: '√Årbol', text: 'Tienen tallo duro y grueso. Sus ramas salen de un tronco.', audio: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE//refs/heads/main/Planta1/Planta2/arbol_tallo.mp3' },
        { type: 'Arbusto', text: 'Su tallo es delgado y duro. Sus ramas nacen cerca del suelo', audio: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE//refs/heads/main/Planta1/Planta2/Arbusto_tallo.mp3' },
        { type: 'Hierba', text: 'Tienen tallo fino y flexible.', audio: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE//refs/heads/main/Planta1/Planta2/Hierba_tallo.mp3' }
    ];

    const game3Data = [
        { type: 'Arboleda', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arboleda1.png' },
        { type: 'Arboleda', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arboleda2.png' },
        { type: 'Arboleda', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/arboleda3.png' },
        { type: 'Matorral', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/matorral1.png' },
        { type: 'Matorral', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/matorral2.png' },
        { type: 'Matorral', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/matorral3.png' },
        { type: 'Pradera', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/pradera1.png' },
        { type: 'Pradera', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/pradera2.png' },
        { type: 'Pradera', img: 'https://raw.githubusercontent.com/ManuelVS8/Audios-juegos-SCIENCE/refs/heads/main/Planta1/Planta2/pradera3.png' }
    ];

    let q1 = [], q2 = [], q3 = [];

    function unlockAudio() { 
        if(audioUnlocked) return; 
        const c=new(window.AudioContext||window.webkitAudioContext)(); 
        const o=c.createOscillator(); 
        const g=c.createGain(); 
        o.connect(g); g.connect(c.destination); g.gain.value=0.0001; o.start(); o.stop(c.currentTime+0.01); 
        audioUnlocked=true; 
    }

    function playSnd(t) { 
        if(!isMuted) { 
            audioObjs[t].currentTime=0; 
            audioObjs[t].play().catch(e => console.log("Audio play error", e)); 
        } 
    }

    function playTaskAudio(url, delay=500) {
        if(isMuted) return;
        if(audioTimeout) clearTimeout(audioTimeout);
        if(currentAudio) { currentAudio.pause(); currentAudio.currentTime=0; }
        audioTimeout = setTimeout(() => { 
            currentAudio = new Audio(url); 
            currentAudio.play().catch(e => console.log("Task audio error", e)); 
        }, delay);
    }

    function showScreen(id) { 
        document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); 
        document.getElementById(id).classList.add('active'); 
    }

    function updateTimer() {
        const d = (Date.now() - startTime)/1000; 
        elapsed = d;
        const m = Math.floor(d/60).toString().padStart(2,'0'), s = Math.floor(d%60).toString().padStart(2,'0');
        document.getElementById('finalTime').textContent = `${m}:${s}`;
    }

    function initGame1() {
        q1 = [...game1Data].sort(()=>Math.random()-0.5);
        currentIndex = 0;
        score1 = 0;
        currentScreen = 'game1';
        if(!timerInterval) { startTime = Date.now(); timerInterval = setInterval(updateTimer, 1000); }
        loadQuestion1();
    }

    function loadQuestion1() {
        if(currentIndex >= q1.length) { 
            initGame2(); 
            return; 
        }
        document.getElementById('plantImg1').src = q1[currentIndex].img;
        document.getElementById('levelLabel1').textContent = `Nivel ${currentIndex + 1}/${q1.length}`;
        document.getElementById('progressFill1').style.width = ((currentIndex / q1.length) * 100) + '%';
        resetButtonStates('game1Screen');
    }

    function initGame2() {
        showScreen('game2Screen');
        q2 = [...game2Data].sort(()=>Math.random()-0.5);
        currentIndex = 0;
        score2 = 0;
        currentScreen = 'game2';
        loadQuestion2();
    }

    function loadQuestion2() {
        if(currentIndex >= q2.length) { 
            initGame3(); 
            return; 
        }
        document.getElementById('defText').textContent = q2[currentIndex].text;
        document.getElementById('levelLabel2').textContent = `Nivel ${currentIndex + 1}/${q2.length}`;
        document.getElementById('progressFill2').style.width = ((currentIndex / q2.length) * 100) + '%';
        playTaskAudio(q2[currentIndex].audio);
        resetButtonStates('game2Screen');
    }

    function initGame3() {
        showScreen('game3Screen');
        q3 = [...game3Data].sort(()=>Math.random()-0.5);
        currentIndex = 0;
        score3 = 0;
        currentScreen = 'game3';
        loadQuestion3();
    }

    function loadQuestion3() {
        if(currentIndex >= q3.length) { 
            finish(); 
            return; 
        }
        document.getElementById('plantImg3').src = q3[currentIndex].img;
        document.getElementById('levelLabel3').textContent = `Nivel ${currentIndex + 1}/${q3.length}`;
        document.getElementById('progressFill3').style.width = ((currentIndex / q3.length) * 100) + '%';
        resetButtonStates('game3Screen');
    }

    function checkAnswer(ans, btn) {
        let correct = false;
        let targetId = '';
        
        if(currentScreen === 'game1') {
            correct = (ans === q1[currentIndex].type);
            if(correct) score1++;
            targetId = 'stageImg1';
        } else if(currentScreen === 'game2') {
            correct = (ans === q2[currentIndex].type);
            if(correct) score2++;
            targetId = 'board2';
        } else if(currentScreen === 'game3') {
            correct = (ans === q3[currentIndex].type);
            if(correct) score3++;
            targetId = 'stageImg3';
        }

        if(correct) {
            btn.classList.add('btn-correct');
            playSnd('correct');
        } else {
            btn.classList.add('btn-error');
            document.getElementById(targetId).classList.add('shake');
            playSnd('error');
            setTimeout(() => document.getElementById(targetId).classList.remove('shake'), 300);
        }

        // Bloquear botones durante la transici√≥n
        const container = btn.parentElement;
        container.querySelectorAll('button').forEach(b => b.style.pointerEvents = 'none');

        setTimeout(() => {
            currentIndex++;
            container.querySelectorAll('button').forEach(b => b.style.pointerEvents = 'auto');
            if(currentScreen === 'game1') loadQuestion1();
            else if(currentScreen === 'game2') loadQuestion2();
            else if(currentScreen === 'game3') loadQuestion3();
        }, 800);
    }

    function resetButtonStates(screenId) {
        document.getElementById(screenId).querySelectorAll('.answer-buttons button').forEach(b => {
            b.classList.remove('btn-correct', 'btn-error');
        });
    }

    function finish() {
        clearInterval(timerInterval);
        const finalScore = Math.round(((score1/q1.length + score2/q2.length + score3/q3.length) / 3) * 100);
        
        document.getElementById('finalScore').textContent = finalScore;
        
        if(finalScore === 100) {
            document.getElementById('trophyBox').style.display = 'block';
            document.getElementById('finalMsg').textContent = '¬°Enhorabuena, puntuaci√≥n m√°xima!';
            playSnd('victory');
            createConfetti();
        } else {
            document.getElementById('trophyBox').style.display = 'none';
            document.getElementById('finalMsg').textContent = '¬°Buen trabajo! Sigue practicando';
            playSnd('completed');
        }
        showScreen('finalScreen');
    }

    function createConfetti() {
        for(let i=0; i<100; i++){
            setTimeout(()=>{
                const c = document.createElement('div');
                c.className = 'confetti';
                const x = Math.random() * window.innerWidth;
                const tx = (Math.random() - 0.5) * 200;
                c.style.left = x + 'px';
                c.style.top = '-10px';
                c.style.backgroundColor = ['#ff595e','#1982c4','#6a4c93','#ffca3a','#8ac926'][Math.floor(Math.random()*5)];
                c.style.setProperty('--tx', tx + 'px');
                c.style.setProperty('--ty', window.innerHeight + 20 + 'px');
                document.body.appendChild(c);
                setTimeout(() => c.remove(), 3000);
            }, i * 20);
        }
    }

    document.getElementById('playBtn').onclick = () => { 
        unlockAudio(); 
        playSnd('tap'); 
        showScreen('game1Screen'); 
        initGame1(); 
    };

    document.getElementById('replayAudioBtn').onclick = () => {
        playSnd('tap');
        playTaskAudio(q2[currentIndex].audio, 0);
    };

    document.getElementById('backToMenuBtn').onclick = () => { 
        playSnd('tap'); 
        location.reload(); 
    };

    document.getElementById('muteBtn').onclick = () => { 
        isMuted = !isMuted; 
        document.getElementById('muteBtn').textContent = isMuted ? 'üîá' : 'üîä'; 
        if(currentAudio) currentAudio.pause(); 
    };
</script>
</body>
</html>